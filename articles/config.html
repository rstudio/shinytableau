<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adding configuration settings • shinytableau</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Adding configuration settings">
<meta property="og:description" content="shinytableau">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shinytableau</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinytableau.html">Introduction to shinytableau</a>
    </li>
    <li>
      <a href="../articles/helloworld.html">Writing your first extension</a>
    </li>
    <li>
      <a href="../articles/config.html">Adding configuration settings</a>
    </li>
    <li>
      <a href="../articles/data.html">Accessing data from Tableau</a>
    </li>
    <li>
      <a href="../articles/example.html">Full ggviolin example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ui.html">UI considerations</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deployment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/shinytableau">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="config_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="config_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="config_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adding configuration settings</h1>
            
      
      
      <div class="hidden name"><code>config.Rmd</code></div>

    </div>

    
    
<style type="text/css">
p>img:first-child:last-child {
  display: block;
  margin-left: auto;
  margin-right: auto;
  border: none;
}
video {
  display: block;
  padding: 0;
  border: 1px solid #AAA;
  margin: 1em auto;
  width: 100%;
  box-sizing: border-box;
}
</style>
<p>Now we’ll see how configuration works by making our tiny extension only slightly more complex: instead of showing the hardcoded string “Hello, world!” we’ll allow the dashboard author to specify who is being greeted.</p>
<p>We will use a configuration dialog to:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Prompt</strong> the dashboard author for the greetee<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</li>
<li>
<strong>Save</strong> their input as a setting called <code>"greetee"</code>
</li>
<li>
<strong>Read</strong> that setting when dynamically rendering the greeting</li>
</ol>
<div id="full-source-code" class="section level2">
<h2 class="hasAnchor">
<a href="#full-source-code" class="anchor"></a>Full source code</h2>
<p>Replace the contents of your <code>app.R</code> file with this code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># filetype: shinyApp</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://shiny.rstudio.com">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">shinytableau</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinyvalidate/">shinyvalidate</a></span><span class="op">)</span>

<span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/yaml_skeleton.html">tableau_manifest_from_yaml</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fillPage.html">fillPage</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="fu"><a href="../reference/shinytableau_theme.html">shinytableau_theme</a></span><span class="op">(</span><span class="op">)</span>, padding <span class="op">=</span> <span class="fl">12</span>,
    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"message"</span>, container <span class="op">=</span> <span class="va">h2</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="fu"><a href="../reference/tableau_setting.html">tableau_setting</a></span><span class="op">(</span><span class="st">"greetee"</span><span class="op">)</span>, <span class="st">"!"</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">config_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textInput.html">textInput</a></span><span class="op">(</span><span class="st">"greetee"</span>, <span class="st">"Whom would you like to greet?"</span>, <span class="st">"world"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">config_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Ensure that the user provides a value for input$greetee</span>
  <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"greetee"</span>, <span class="fu"><a href="https://rstudio.github.io/shinyvalidate//reference/sv_required.html">sv_required</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># config_server must have a save_settings function</span>
  <span class="va">save_settings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/update_tableau_settings_async.html">update_tableau_settings_async</a></span><span class="op">(</span>
      greetee <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">greetee</span>
    <span class="op">)</span>
  <span class="op">}</span>

  <span class="co"># config_server must always return the save_settings function</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">save_settings</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/tableau_extension.html">tableau_extension</a></span><span class="op">(</span><span class="va">manifest</span>, <span class="va">ui</span>, <span class="va">server</span>, <span class="va">config_ui</span>, <span class="va">config_server</span>,
  options <span class="op">=</span> <span class="fu"><a href="../reference/ext_options.html">ext_options</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fl">3456</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p>If your RStudio session is still running the previous version of the code we wrote, stop it now by either clicking in the Console pane and hitting Escape, or pressing the stop-sign icon in the Console toolbar. Then run the new code with Ctrl+Shift+Enter/Cmd+Shift+Return. This will launch the extension’s Info page again, but you can just ignore it.</p>
</div>
<div id="reloading-the-extension" class="section level2">
<h2 class="hasAnchor">
<a href="#reloading-the-extension" class="anchor"></a>Reloading the extension</h2>
<p>If you now switch back to Tableau, you will see that your extension is greyed out. This is because when you stopped the app in RStudio, the connection between Tableau and the extension was broken. Now that the app is running again, you will need to reload the extension:</p>
<ul>
<li><p>If you’re using Tableau Desktop, select the extension, and from the <em>More Options</em> menu (the triangle icon on the border of the extension, see the next screenshot) choose <em>Reload</em>.</p></li>
<li><p>If you’re using Tableau Server or Tableau Online, reload the browser.</p></li>
</ul>
<p>This will be our normal workflow whenever we make a change to our <code>app.R</code> file: restart the Shiny app in RStudio, then reload the extension (or page) in Tableau.</p>
</div>
<div id="invoking-the-config-dialog" class="section level2">
<h2 class="hasAnchor">
<a href="#invoking-the-config-dialog" class="anchor"></a>Invoking the config dialog</h2>
<p>Now you should see something like the following screenshot: the extension object shows only the name of the extension, and a message that you need to configure the extension.</p>
<p><img src="tutorial-2a.png" width="573"></p>
<p>Clicking Configure shows a text input:</p>
<p><img src="tutorial-2b.png" width="421"></p>
<p>Type in a value and click OK, and you should see the extension object instantly update to reflect your change.</p>
<p><img src="tutorial-2c.png" width="573"></p>
<hr>
<p>Compared to the “Hello, World!” version, we’ve made a number of important changes that accomplish two things: defining a configuration dialog, and reading settings that are set based on user input to that dialog.</p>
</div>
<div id="creating-the-config-dialog" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-config-dialog" class="anchor"></a>Creating the config dialog</h2>
<p>Most obviously, we now have <code>config_ui</code> and <code>config_server</code>, which together represent the configuration dialog. These two variables are passed to <code>tableau_extension</code> as the next two arguments after <code>ui</code> and <code>server</code>.</p>
<p>The job of <code>config_ui</code>/<code>config_server</code> is to take input about the user’s preferences (in this case, what message should be displayed), and save them as <em>settings</em>. Each extension instance has its own set of settings; that is, if the same extension is dropped on a dashboard three times, then there are three extension instances, each with their own completely independent config dialogs and settings.</p>
<p>There are several essential requirements for <code>config_ui</code> and <code>config_server</code> that you need to know about.</p>
<div id="config_ui" class="section level3">
<h3 class="hasAnchor">
<a href="#config_ui" class="anchor"></a>config_ui</h3>
<p>As we said about <code>ui</code> above, <code>config_ui</code> needs to be a <code>function(req) { ... }</code> that returns some UI object, not just the UI object itself as you can do in a normal Shiny app.</p>
<p>Also, most Shiny <code>ui</code> (including shinytableau ones) should have a <code>fluidPage</code>, <code>fillPage</code>, or other page function as their outermost call, but this isn’t the case with <code>config_ui</code>. The UI you return from <code>config_ui</code> will be inserted into a configuration dialog UI that shinytableau creates for you. So instead of <code><a href="https://shiny.rstudio.com/reference/shiny/latest/fillPage.html">fillPage()</a></code>, use <code><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">config_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textInput.html">textInput</a></span><span class="op">(</span><span class="st">"greetee"</span>, <span class="st">"Whom would you like to greet?"</span>, <span class="st">"world"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></pre></div>
</div>
<div id="config_server" class="section level3">
<h3 class="hasAnchor">
<a href="#config_server" class="anchor"></a>config_server</h3>
<p>There are two new requirements for <code>config_server</code> versus a regular <code>server</code>. First, a normal Shiny <code>server</code> is a function that takes <code>input</code>, <code>output</code>, and <code>session</code> arguments; a <code>config_server</code> takes an additional <code>iv</code> argument. This represents an <code>InputValidator</code> object from the <a href="https://rstudio.github.io/shinyvalidate/articles/shinyvalidate.html">shinyvalidate</a> package. You use <code>iv</code> to tell shinytableau which user inputs <em>must</em> be provided, and any validation rules that must be enforced. Any required inputs that are missing, or failing validation rules, will display errors in the form and prevent the OK and Apply buttons from taking effect.</p>
<p>Second, a <code>config_server</code> function must declare a <code>save_settings</code> function, and must return this function. This is in contrast to regular Shiny server functions, which do not return anything<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. The <code>save_settings</code> function should take no arguments and, when called, should call <a href="https://rstudio.github.io/shinytableau/reference/update_tableau_settings_aync.html"><code>update_tableau_settings_async</code></a> to persist whatever settings the user has specified. In this case, we’re taking the user input, <code>input$greetee</code>, and persisting that as a setting named <code>greetee</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">config_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span>, <span class="va">iv</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Ensure that the user provides a value for input$greetee</span>
  <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"greetee"</span>, <span class="fu"><a href="https://rstudio.github.io/shinyvalidate//reference/sv_required.html">sv_required</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># config_server must have a save_settings function</span>
  <span class="va">save_settings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/update_tableau_settings_async.html">update_tableau_settings_async</a></span><span class="op">(</span>
      greetee <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">greetee</span>
    <span class="op">)</span>
  <span class="op">}</span>
  
  <span class="co"># config_server must always return the save_settings function</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">save_settings</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>(Advanced R users may be wondering if, rather than declaring and returning <code>save_settings</code>, simply having an anonymous function as the last expression would be sufficient. Yes, that works, but doing it the recommended way makes the intent more immediately obvious.)</p>
<p>The values you pass to <code><a href="../reference/update_tableau_settings_async.html">update_tableau_settings_async()</a></code> will be saved as JSON objects, so it’s a good idea to keep things simple: atomic numeric, character, and logical vectors are safe to use, as are unnamed and named lists. <code>NULL</code> is fine too. It’s not a good idea to save more specialized objects like factors, data frames, environments, R6 objects. Even Date objects should probably be converted to character first, and parsed back into a Date by whomever is reading the setting.</p>
<p>Speaking of reading settings…</p>
</div>
</div>
<div id="reading-settings" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-settings" class="anchor"></a>Reading settings</h2>
<p>Now that we’ve discussed how <code>config_ui</code> and <code>config_server</code> can let you write settings, we can talk about the much simpler topic of how to read settings from the extension object (i.e. <code>server</code>).</p>
<p>The main way you’ll access settings is by calling <code><a href="../reference/tableau_setting.html">tableau_setting(setting_name)</a></code>, e.g. <code><a href="../reference/tableau_setting.html">tableau_setting("greetee")</a></code> in the example above. The important thing to note is that <code>tableau_setting</code> performs a <em>reactive</em> read, so whomever is doing the reading (i.e. reactive expression, reactive observer, or reactive output) will be triggered when the setting changes.</p>
<p>You can call <code><a href="../reference/tableau_setting.html">tableau_settings_all()</a></code> to retrieve all of the current settings as a list. Generally you should try to use <code>tableau_setting</code> in favor of <code>tableau_settings_all</code>, because the latter takes a reactive dependency on <em>all</em> of the settings, even if you’re not actually interested in all of them.</p>
<div class="nextstep">
<p><strong>Next step:</strong> <a href="data.html">Accessing data from Tableau</a></p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Yes, it’s a <a href="https://en.wiktionary.org/wiki/greetee">real word</a>!<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Although Shiny <em>module</em> server functions often do return objects to their callers.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Cheng, Richard Iannone, Javier Luraschi,  RStudio.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
